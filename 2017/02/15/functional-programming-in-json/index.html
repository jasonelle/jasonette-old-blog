<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Designing a Functional Programming Language in JSON &middot; jasonette
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://jasonelle.com/jasonette-old-blog/public/css/poole.css">
  <link rel="stylesheet" href="http://jasonelle.com/jasonette-old-blog/public/css/syntax.css">
  <link rel="stylesheet" href="http://jasonelle.com/jasonette-old-blog/public/css/hyde.css?1491595318605540000">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Crimson+Text:400,400italic,700,700italic" rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://jekyll.gtat.me/assets/css/entypo.css" media="all">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

	<!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Designing a Functional Programming Language in JSON - jasonette</title>
<meta property="og:title" content="Designing a Functional Programming Language in JSON" />
<meta name="description" content="Today, let me show you something you have never seen--a programming language written in JSON." />
<meta property="og:description" content="Today, let me show you something you have never seen--a programming language written in JSON." />
<link rel="canonical" href="http://jasonelle.com/jasonette-old-blog/2017/02/15/functional-programming-in-json/" />
<meta property="og:url" content="http://jasonelle.com/jasonette-old-blog/2017/02/15/functional-programming-in-json/" />
<meta property="og:site_name" content="jasonette" />
<meta property="og:image" content="http://jasonelle.com/jasonette-old-blog/assets/halflife.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-02-15T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@jasonclient" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Designing a Functional Programming Language in JSON",
"image": "http://jasonelle.com/jasonette-old-blog/assets/halflife.jpg",
"datePublished": "2017-02-15T00:00:00-05:00",
"description": "Today, let me show you something you have never seen--a programming language written in JSON.",
"url": "http://jasonelle.com/jasonette-old-blog/2017/02/15/functional-programming-in-json/"}</script>
<!-- End Jekyll SEO tag -->


  <body class="layout-reverse">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          <img class='logo' src='http://jasonelle.com/jasonette-old-blog/assets/jasonette.png'>
          <br>
          jasonette
        </a>
      </h1>
      <p class="lead">⚡️ Native App over HTTP</p>
    </div>

    <nav class="sidebar-nav">
      <!--
      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
      
        
      
        
          
        
      
        
          
        
      
      -->
      <a class="sidebar-nav-item inline nopadding" href="http://jasonelle.com/">About</a>
      <a class="sidebar-nav-item inline nopadding" href="http://jasonelle.com/blog">Blog</a>
      <a class="sidebar-nav-item inline nopadding" href="https://docs.jasonette.com">Docs</a>
      <!--<div class='sidebar-nav-item bold'>Subscribe to Newsletter</div>
			<div class='sidebar-nav-item nopadding'>
				<form action="//textethan.us8.list-manage.com/subscribe/post?u=54e23b3fe61843c19c384fc05&amp;id=76d5746d7b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="novalidate">
					<p>Important updates, milestones, new projects, and useful tips from the community.</p>
					<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="enter email" aria-required="true">
					<button type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">Subscribe</button>
					<div id="mce-responses" class="clear">
							<div class="response" id="mce-error-response" style="display:none"></div>
							<div class="response" id="mce-success-response" style="display:none"></div>
					</div>
					<div style="position: absolute; left: -5000px;" aria-hidden="true">
							<input type="text" name="b_54e23b3fe61843c19c384fc05_76d5746d7b" tabindex="-1" value="">
					</div>
				</form>
			</div>
      --><div class='sidebar-nav-item bold'>Community</div>
      <a class="sidebar-nav-item inline" href="https://jasonette.now.sh/">Slack</a>
			<a class="sidebar-nav-item inline" href="https://jasonelle.com/">Forum</a>
			<a class="sidebar-nav-item inline" href="https://jasonelle.com/">Twitter</a>
      <div class='sidebar-nav-item bold'>Github</div>
			<a class="sidebar-nav-item icon" href="https://github.com/jasonelle/JASONETTE-Android">Android <img src='http://jasonelle.com/jasonette-old-blog/assets/android.png'></a>
			<a class="sidebar-nav-item icon" href="https://github.com/jasonelle/JASONETTE-iOS">iOS <img src='http://jasonelle.com/jasonette-old-blog/assets/apple.png'></a>
      <!--
      <div class='sidebar-nav-item bold'>RSS</div>
			<a class="sidebar-nav-item icon" href='/atom.xml'><img src='http://jasonelle.com/jasonette-old-blog/assets/feed.png'></a>
      -->
    </nav>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Designing a Functional Programming Language in JSON</h1>
  <span class="post-date">15 Feb 2017</span>
  <p>Today, let me show you something you have never seen--<strong>a programming language written in JSON</strong>.</p>

<p>And not just any programming, but <strong><a href="https://en.wikipedia.org/wiki/Functional_programming">functional programming</a></strong>.</p>

<p><img src="http://jasonelle.com/jasonette-old-blog/assets/halflife.jpg" alt="lambda"></p>

<p>Here&#39;s the summary of this article:</p>

<ol>
<li><strong>Anatomy of a function</strong></li>
<li><strong>How to write a function in JSON</strong></li>
<li><strong>Expressing function call stacks and return values in JSON</strong></li>
</ol>

<hr>

<p>Note: This post discusses the technology behind <a href="https://www.jasonette.com">Jasonette</a>, an open source framework that lets you <strong>make cross-platform mobile apps with just a JSON markup</strong>.</p>

<p>Expressing all of Model-View-Controller logic in pure JSON is not a simple task, and each deserves its own article. I have already written an article about the <a href="https://medium.freecodecamp.com/how-to-build-cross-platform-mobile-apps-using-nothing-more-than-a-json-markup-f493abec1873#.i83lzc4g9">view-side logic</a>.</p>

<p>But in this article, it&#39;s all about the <strong>controller logic</strong>. More specifically, functions.</p>

<hr>

<p><br></p>

<h1>1. Anatomy of a function</h1>

<p>Programming languages are supposed to carry out useful tasks. Normally these exist in the form of <strong>functions</strong>. Let&#39;s take a look at <strong>Javascript</strong> for example.</p>

<hr>

<p><strong>1. A function has a <code>name</code> and <code>arguments</code>.</strong></p>

<p><strong>Names</strong> let you reference functions in a unique manner.</p>

<p>You pass <strong>Arguments</strong> to functions so they can be processed.</p>

<p><img src="/assets/function_name_arguments.png" alt="function"></p>

<hr>

<p><strong>2. <code>Callback</code> is when you pass a function as an argument to another function.</strong></p>

<p>Callbacks are important in any application that involves asynchronous tasks such as network requests, processing user interactions, etc. because you have to delay the callback function&#39;s execution until it&#39;s time.</p>

<p><img src="/assets/function_callbacks.png" alt="function"></p>

<hr>

<p>So the question is: How can we use a JSON object to describe things like this?</p>

<p><br></p>

<h1>2. Writing a function in JSON</h1>

<p>Jasonette has something called <a href="http://docs.jasonette.com/actions/">actions</a>. Actions describe tasks. Each action consists of up to four attributes:</p>

<ol>
<li><code>type</code>: name of a native function to run</li>
<li><code>options</code>: arguments to pass to the function</li>
<li><code>success</code>: success callback to run when the function returns success</li>
<li><code>error</code>: error callback to run when the function returns error</li>
</ol>

<p>Using just these four attributes, you can build any kind of fully functional app.</p>

<p><br></p>

<h2>Arguments</h2>

<p>Functions are not so meaningful without arguments. We want a function to perform different actions based on the arguments we pass to it.</p>

<p>Here we pass <code>title</code> and <code>description</code> attributes to <a href="http://docs.jasonette.com/actions/#utilalert">$util.alert</a> action to create a custom alert dialog.</p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$util.alert"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Basic Alert"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"I'm a basic alert. I simply display an alert that needs to be dismissed before moving forward"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>When you run this action on Jasonette, It displays an alert that looks like the following:</p>

<p><span class='col-6'>
  <span>iOS</span>
  <img class='bordered medium' src='http://jasonelle.com/jasonette-old-blog/assets/alert_ios.png'>
</span>
<span class='col-6'>
  <span>Android</span>
  <img class='bordered medium' src='http://jasonelle.com/jasonette-old-blog/assets/alert_android.png'>
</span></p>

<p><br></p>

<h2>Callbacks</h2>

<p>Since most things that happen on mobile devices are asynchronous in nature, callbacks are first-class citizens and built into actions on Jasonette.</p>

<p>There are two types of callbacks: <code>success</code> and <code>error</code>. <code>success</code> gets called when the action succeeds. <code>error</code> when it fails.</p>

<p>Here&#39;s an example of a <code>success</code> callback:</p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"fetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$network.request"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://jsonplaceholder.typicode.com/posts"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$render"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Here&#39;s what it does:</p>

<ol>
<li>Makes a network request (<a href="http://docs.jasonette.com/actions/#networkrequest">$network.request</a>) to <a href="https://jsonplaceholder.typicode.com/">jsonplaceholder server</a></li>
<li>Passes that result to its <code>success</code> callback action--which is another action called <a href="http://docs.jasonette.com/actions/#render">$render</a>--which renders the result using whichever template you define (also in JSON).</li>
<li>We name the action <code>fetch</code> by wrapping it with the key.</li>
</ol>

<p><br></p>

<h2>Evaluation</h2>

<p>Since the native language of JSON is Javascript (JSON is short for JavaScript Object Notation), Jasonette implements evaluation using a built-in Javascript engine. If you want to evaluate something, simply wrap it inside a template expression (<code>{{ }}</code>).</p>

<p><strong>Inline Javascript means we can do some crazy stuff like this:</strong></p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"fetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$network.request"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://....."</span><span class="p">,</span><span class="w">
      </span><span class="nt">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{var str=$cache.guid; var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='; for ( var block, charCode, idx = 0, map = chars, output = ''; str.charAt(idx | 0) || (map = '=', idx % 1); output += map.charAt(63 &amp; block &gt;&gt; 8 - idx % 1 * 8)) { charCode = str.charCodeAt(idx += 3/4); if (charCode &gt; 0xFF) { throw new InvalidCharacterError('btoa failed'); } block = block &lt;&lt; 8 | charCode; } return output;}}"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$render"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Here&#39;s what&#39;s going on:</p>

<ol>
<li>We try to make a network request using the data specified inside <code>options.data</code>.</li>
<li>But the value of <code>guid</code> is a <a href="http://docs.jasonette.com/templates/">template expression</a>, so the interpreter first executes the Javascript inside the template expression to determine the final value.</li>
<li>If you look closely at the Javascript code, it takes the <code>$cache.guid</code> (<a href="http://docs.jasonette.com/actions/#cache">$cache</a> is a global variable for persisting data on the device) and <strong>generates a hash from it</strong>. It&#39;s basically a manual implementation of javascript&#39;s native <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding">btoa function</a>.</li>
<li>After all that&#39;s done, it finally makes the network request with the final value.</li>
<li>Then it calls <code>$render</code> via its <code>success</code> callback.</li>
</ol>

<p><br></p>

<hr>

<h1>Intermission</h1>

<p><strong>Everything below this point is completely NEW to Jasonette with the latest release.</strong></p>

<hr>

<p><br></p>

<h1>Transition from Message dispatch to Function calls</h1>

<p>So far I made it sound like actions on Jasonette are like functions. But it was only half true.</p>

<h2>How it used to work</h2>

<p>In the previous versions of Jasonette, every action would terminate immediately after calling its <code>success</code> or <code>error</code> callback. Here&#39;s what a typical action call chain looked like:</p>

<ol>
<li>Action 1 calls Action 2 and terminates.</li>
<li>Action 2 does its job, and calls Action 3, then terminates.</li>
<li>Action 3 does its job, and calls Action 4, then terminates. etc.</li>
</ol>

<p>While not perfect, this model works fine because each action callback passes its result onto the next action (packaged as a variable called <code>$jason</code>), and as long as each action keeps doing its job correctly and propagates the correct value, the last action in the call chain would end up with expected results.</p>

<h2>Problem</h2>

<p>The probelm is, <strong>you can&#39;t create subroutines</strong> with this architecture. It&#39;s impossible to do something as straight-forward as: </p>

<ol>
<li>Action 1 calls Action 2 and waits.</li>
<li>Action 2 finishes running, and sends a return value back to Action 1.</li>
<li>Action 1 picks up where it left off and carries on with the return value from Action 2.</li>
</ol>

<p>It&#39;s impossible because every action immediately terminates after triggering another action--it can&#39;t wait for its subroutine to return.</p>

<p>In this sense, calling an <code>action</code> was more like a <strong>message dispatch</strong> than a <strong>function</strong>.</p>

<p>Functions have call stacks, their own local states, and most importantly, return values. And there are no such things when you&#39;re simply dispatching messages.</p>

<p>Without a way to implement subroutines:</p>

<ol>
<li><strong>It&#39;s impossible to write modular code</strong></li>
<li><strong>Writing recursive algorithms is not trivial</strong></li>
</ol>

<p><br></p>

<p><img src='https://imgs.xkcd.com/comics/functional.png' class='medium'></p>

<p>This was not a serious problem initially, when most people just used Jasonette to write small apps and prototypes. But as people started to realize they can actually write production apps this way, this became problematic because they started writing thousands of lines. Imagine reading through thousands of lines of JSON code with absolutely no modularity.</p>

<p><br></p>

<h1>Expressing function call stacks &amp; return values in JSON</h1>

<p>To address this we needed a way for an action to:</p>

<ol>
<li>Invoke another action</li>
<li>Wait for the callee action to return, and continue on with the return value once it returns.</li>
</ol>

<p>Also it would be best <strong>if we didn&#39;t invent a new concept just for this, but instead simply come up with just another new action to achieve this.</strong></p>

<p>So <a href="http://docs.jasonette.com/actions/#lambda">$lambda</a> and <a href="http://docs.jasonette.com/actions/#returnsuccess">$return</a> were born.</p>

<p><br></p>

<h2>$lambda</h2>

<p><a href="http://docs.jasonette.com/actions/#lambda">$lambda</a> is a special purpose action whose sole purpose is to trigger another action. Unlike other actions which carry out some task, it only functions as a mediator that</p>

<ol>
<li>Executes another action</li>
<li>Waits for it to return</li>
<li>Resumes and starts executing the next action with the return value</li>
</ol>

<p>The <code>$lambda</code> action takes two arguments as its <code>options</code>:</p>

<ol>
<li><code>name</code>: The name of the function to trigger</li>
<li><code>options</code>: An options object to pass to the triggering action.</li>
</ol>

<p>Let&#39;s take a look at an example usage of <code>$lambda</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"fetch"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$lambda"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btoa"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{$cache.guid}}"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$network.request"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://....."</span><span class="p">,</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{$jason.hashed}}"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$render"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>In this example,</p>

<ol>
<li>We invoke an action called <code>btoa</code> (which we will come back to in the next section) using <code>$lambda</code>.</li>
<li>Then the <code>$lambda</code> action waits until the <code>btoa</code> action completes its task and returns.</li>
<li>Finally when that happens, the <code>$lambda</code> action&#39;s <code>success</code> callback gets executed.</li>
<li>Note that the success action is a <a href="http://docs.jasonette.com/actions/#networkrequest">$network.request</a> action that uses the return value from <code>btoa</code> in the form of the variable <code>$jason</code>.</li>
</ol>

<p><br></p>

<h2>$return</h2>

<p><code>$return</code> is actually not a single action but a category of actions. There are two:</p>

<ol>
<li><a href="http://docs.jasonette.com/actions/#returnsuccess">$return.success</a> : Used for returning values on success. This will backtrack to the current action&#39;s caller action and execute its <code>success</code> callback.</li>
<li><a href="http://docs.jasonette.com/actions/#returnerror">$return.error</a> : Used for returning an error. This will backtrack to the current action&#39;s caller action and execute its <code>error</code> callback.</li>
</ol>

<p>There are two ways of returning--<strong>with return value</strong> and <strong>without return value</strong></p>

<ul>
<li><strong>Without return value:</strong> If the action doesn&#39;t need to return any value, simply doing <code>&quot;type&quot;: &quot;$return.success&quot;</code> is enough to return the control back to the caller action.</li>
<li><strong>With return value:</strong> However if you wish to send a return value back to the caller action, you will need to set the <code>options</code>.</li>
</ul>

<p>For example, when you <code>$return.success</code> this way:</p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"myname"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$return.success"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bart"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Simpson"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>You will be able to access the <code>options</code> object as <code>$jason</code> in the caller action&#39;s <code>success</code> callback. Here&#39;s an example:</p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$lambda"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"myname"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$util.toast"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My name is {{$jason.firstname}} {{$jason.lastname}}"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Notice how the <a href="http://docs.jasonette.com/actions/#utiltoast">$util.toast</a> is accessing the <code>$jason.firstname</code> and <code>$jason.lastname</code> values after the <code>myname</code> action returns. </p>

<p><br></p>

<p>Circling back to our <code>btoa</code> action, here&#39;s what it looks like when we extract the <code>btoa</code> action out as a standalone function. All it does is compute the hash and return. (It&#39;s basically a manual implementation of <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding">the native btoa function</a>.</p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"btoa"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$return.success"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"hashed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{var str=$jason.guid; var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='; for ( var block, charCode, idx = 0, map = chars, output = ''; str.charAt(idx | 0) || (map = '=', idx % 1); output += map.charAt(63 &amp; block &gt;&gt; 8 - idx % 1 * 8)) { charCode = str.charCodeAt(idx += 3/4); if (charCode &gt; 0xFF) { throw new InvalidCharacterError('btoa failed'); } block = block &lt;&lt; 8 | charCode; } return output;}}"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Notice that the function uses <code>var str=$jason.guid;</code> (previously it was <code>var str=$cache.guid;</code>).</p>

<p><code>$jason</code> is the argument passed in from the caller action, which means it only exists within this local scope. The function doesn&#39;t use global variables like <code>$cache</code> anymore.</p>

<p><br></p>

<h2>Simplifying $lambda with &#39;trigger&#39;</h2>

<p><code>$lambda</code> actions can be a bit verbose, so there&#39;s a syntactic sugar for calling <code>$lambda</code> actions.</p>

<p>Instead of using the <code>$lambda</code> action directly, you can use the <code>trigger</code> keyword to shorten it down.</p>

<p>Instead of the following <code>$lambda</code> action:</p>
<div class="highlight"><pre><code class="language-" data-lang="">&lt;Action&gt; ::= {
  "type": "$lambda",
  "options": {
    "name": &lt;Action Name&gt;,
    "options": &lt;Arguments object&gt;
  },
  "success": &lt;Action&gt;,
  "error": &lt;Action&gt;
}
</code></pre></div>
<p>We can use the <code>trigger</code> notation like this:</p>
<div class="highlight"><pre><code class="language-" data-lang="">&lt;Action&gt; ::= {
  "trigger": &lt;Action Name&gt;,
  "options": &lt;Arguments object&gt;,
  "success": &lt;Action&gt;,
  "error": &lt;Action&gt;
}
</code></pre></div>
<p>For example, instead of this:</p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$lambda"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some_action"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value2"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$render"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$render"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>You can use: </p>
<div class="highlight"><pre><code class="language-" data-lang=""><span class="p">{</span><span class="w">
  </span><span class="nt">"trigger"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some_action"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value2"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$render"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$render"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><br></p>

<h1>Stay Tuned for Part 2 and 3</h1>

<p>If you read this far, you&#39;re either thinking:</p>

<ol>
<li>&quot;This is the awesomest thing since Jasonette!&quot; (probably like 5% of you)</li>
<li>or, &quot;Yeah cool story bro, now you can do some hipster functional stuff, so what?&quot; (the rest 95%)</li>
</ol>

<p>I think those of you who have already written long lines of JSON code may immediately get the benefit since it directly deals with your pain point. But even if you&#39;re in the group #2, don&#39;t feel bad!</p>

<p>Because this is the first piece of the puzzle towards introducing <strong>total modularity</strong> to Jasonette, and I have two more posts coming up where I will talk about how all this fits into the picture.</p>

<p>Stay tuned for the next one very soon.</p>

<hr>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2017/04/07/JSON-web-container/">
            JSON web container
            <small>07 Apr 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2017/03/02/self-mixin/">
            Self Mix-in
            <small>02 Mar 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2017/02/27/mixins/">
            Mix~in!
            <small>27 Feb 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
